<Page x:Class="TicketManagementSystem.Client.Views.TicketManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:TicketManagementSystem.Client.ViewModels"
      Title="Ticket Management">

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="20" Margin="10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸŽ«" FontSize="30" Margin="0,0,15,0" VerticalAlignment="Center" 
                           Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text="Ticket Management" FontSize="24" FontWeight="Bold" 
                           VerticalAlignment="Center" Foreground="{StaticResource TextBrush}"/>
                <Button Content="Add" Command="{Binding AddTicketCommand}" 
                        Foreground="White"
                        Background="{StaticResource PrimaryBrush}"
                        BorderThickness="0"
                        Width="80"
                        Height="30"
                        FontSize="15"
                        Margin="10,0,0,0">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" CornerRadius="0">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Tickets List -->
            <Border Grid.Column="0" Background="{StaticResource CardBrush}" 
                    BorderBrush="#DDD" BorderThickness="1"
                    Padding="20" Margin="0,0,10,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="My Tickets" FontSize="18" FontWeight="Bold" 
                               Margin="0,0,0,15" Foreground="{StaticResource TextBrush}"/>

                    <DataGrid Grid.Row="1" ItemsSource="{Binding Tickets}" 
                              AutoGenerateColumns="False" 
                              SelectedItem="{Binding SelectedTicket}"
                              CanUserAddRows="False"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              Background="Transparent"
                              BorderThickness="0"
                              MouseDoubleClick="DataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*"/>
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                            <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat='{}{0:yyyy-MM-dd}'}" Width="100"/>
                            <DataGridTextColumn Header="Assigned To" Binding="{Binding AssignedUser.FullName}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- Ticket Details -->
            <Border Grid.Column="1" Background="{StaticResource CardBrush}" 
                    BorderBrush="#DDD" BorderThickness="1"
                    Padding="20" Margin="10,0,0,0">
                <StackPanel>
                    <TextBlock Text="Ticket Details" FontSize="18" FontWeight="Bold" 
                               Margin="0,0,0,15" Foreground="{StaticResource TextBrush}"/>

                    <TextBlock Text="Select a ticket to view details" 
                               Foreground="{StaticResource TextBrush}"
                               Visibility="{Binding SelectedTicket, Converter={StaticResource NullToVisibilityConverter}}"/>

                    <StackPanel Visibility="{Binding SelectedTicket, Converter={StaticResource ObjectToVisibilityConverter}}">
                        <TextBlock Text="Title:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding SelectedTicket.Title}" IsReadOnly="True" Margin="0,0,0,15"/>

                        <TextBlock Text="Description:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding SelectedTicket.Description}" IsReadOnly="True" 
                                 TextWrapping="Wrap" Height="80" Margin="0,0,0,15"/>

                        <TextBlock Text="Status:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding SelectedTicket.Status}" Margin="0,0,0,15">
                            <ComboBoxItem>To Do</ComboBoxItem>
                            <ComboBoxItem>Progress</ComboBoxItem>
                            <ComboBoxItem>Review</ComboBoxItem>
                            <ComboBoxItem>Done</ComboBoxItem>
                            <ComboBoxItem>Closed</ComboBoxItem>
                        </ComboBox>

                        <Button Content="Save Changes" Command="{Binding UpdateTicketCommand}" 
                                Background="{StaticResource PrimaryBrush}"
                                Foreground="White"
                                BorderThickness="0"
                                Height="35"
                                Margin="0,10,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
