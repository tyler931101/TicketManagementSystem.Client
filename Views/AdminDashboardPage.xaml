<Page x:Class="TicketManagementSystem.Client.Views.AdminDashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:TicketManagementSystem.Client.ViewModels"
      Title="AdminDashboard">

    <Page.Resources>
    </Page.Resources>

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="150"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Style="{StaticResource GlobalHeaderStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Title Row -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                    <Image Source="../Resources/PageLinkIcons/user.png"
                            Style="{StaticResource GlobalHeaderIconStyle}"/>
                    <TextBlock Text="Admin Dashboard" Style="{StaticResource GlobalHeaderTitleStyle}"/>
                </StackPanel>

                <!-- Search Row -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Search Controls -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="Search:" Style="{StaticResource GlobalHeaderLabelStyle}" Width="60"/>
                        <TextBox x:Name="SearchBox" Style="{StaticResource GlobalHeaderTextBoxStyle}"
                                Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Text="Page Size:" Style="{StaticResource GlobalHeaderLabelStyle}" Width="70"/>
                        <ComboBox x:Name="PageSizeComboBox" Style="{StaticResource GlobalHeaderComboBoxStyle}"
                                Width="80" SelectedValue="{Binding PageSize, Mode=TwoWay}" SelectedValuePath="Tag">
                            <ComboBoxItem Tag="5" Content="5"/>
                            <ComboBoxItem Tag="10" Content="10"/>
                            <ComboBoxItem Tag="20" Content="20"/>
                            <ComboBoxItem Tag="50" Content="50"/>
                        </ComboBox>

                        <Button Content="Clear Filters" Command="{Binding ClearFiltersCommand}"
                                Style="{StaticResource GlobalHeaderButtonStyle}"
                                Width="100" Height="30" Margin="10,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ScrollViewer.Resources>
                <Style TargetType="ScrollBar" BasedOn="{StaticResource ModernScrollBarStyle}"/>
            </ScrollViewer.Resources>
            
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Users Table -->
                <Border Grid.Row="0" Background="{StaticResource CardBrush}" Padding="15,12,15,12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Users DataGrid -->
                        <DataGrid Grid.Row="1" x:Name="UsersDataGrid"
                                ItemsSource="{Binding FilteredUsers}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                CanUserReorderColumns="False"
                                CanUserResizeColumns="True"
                                CanUserResizeRows="False"
                                CanUserSortColumns="True"
                                GridLinesVisibility="Horizontal"
                                HorizontalGridLinesBrush="#E0E0E0"
                                VerticalGridLinesBrush="Transparent"
                                Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                Padding="5">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#F8F9FA"/>
                                    <Setter Property="Foreground" Value="#495057"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="14"/>
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="BorderBrush" Value="#DEE2E6"/>
                                    <Setter Property="BorderThickness" Value="0,0,1,0"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background" Value="White"/>
                                    <Setter Property="Height" Value="40"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#F8F9FA"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#E3F2FD"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="#495057"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="#1976D2"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="200"/>
                                <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="250"/>
                                <DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="120"/>
                                <DataGridTextColumn Header="Login Allowed" Binding="{Binding IsLoginAllowed}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Pagination Controls -->
                        <Border Grid.Row="2" Background="#F8F9FA" Padding="15,10" Margin="0,10,0,0" 
                                BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Page Info -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Showing " Foreground="#6C757D" FontSize="14"/>
                                    <TextBlock Text="{Binding StartRecord}" Foreground="#495057" FontWeight="SemiBold" FontSize="14" Margin="2,0"/>
                                    <TextBlock Text=" to " Foreground="#6C757D" FontSize="14"/>
                                    <TextBlock Text="{Binding EndRecord}" Foreground="#495057" FontWeight="SemiBold" FontSize="14" Margin="2,0"/>
                                    <TextBlock Text=" of " Foreground="#6C757D" FontSize="14"/>
                                    <TextBlock Text="{Binding TotalRecords}" Foreground="#495057" FontWeight="SemiBold" FontSize="14" Margin="2,0"/>
                                    <TextBlock Text=" entries" Foreground="#6C757D" FontSize="14"/>
                                </StackPanel>
                                
                                <!-- Pagination Buttons -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button Content="Previous" Command="{Binding PreviousPageCommand}" 
                                            Background="White" Foreground="#495057" BorderBrush="#DEE2E6" 
                                            BorderThickness="1" Padding="12,6" Margin="0,0,8,0"
                                            FontSize="13" Cursor="Hand"/>
                                    
                                    <!-- Dynamic Page Numbers -->
                                    <ItemsControl ItemsSource="{Binding PageNumbers}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Content="{Binding}" 
                                                        Command="{Binding DataContext.GoToPageCommand, RelativeSource={RelativeSource AncestorType=Page}}" 
                                                        CommandParameter="{Binding}"
                                                        Background="White" Foreground="#495057" BorderThickness="1" 
                                                        Padding="10,6" Margin="0,0,4,0" FontSize="13" Cursor="Hand" Width="35"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    
                                    <TextBlock Text="..." Foreground="#6C757D" VerticalAlignment="Center" 
                                               Margin="0,0,4,0" FontSize="13" 
                                               Visibility="{Binding ShowEllipsis, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    
                                    <Button Content="{Binding LastPageNumber}" Command="{Binding GoToLastPageCommand}"
                                            Background="White" Foreground="#495057" BorderThickness="1" 
                                            Padding="10,6" Margin="0,0,8,0" FontSize="13" Cursor="Hand" Width="35"/>
                                    
                                    <Button Content="Next" Command="{Binding NextPageCommand}" 
                                            Background="White" Foreground="#495057" BorderBrush="#DEE2E6" 
                                            BorderThickness="1" Padding="12,6" FontSize="13" Cursor="Hand"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
